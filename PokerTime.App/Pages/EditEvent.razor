@page "/events/{EventId:guid}"

@attribute [Authorize]


<style>
    .center-element{
        margin-left: auto;
        margin-right: auto;

    }

    .invitee-current {
        border-radius: 5px;
        box-shadow: 0px 0px 6px 0px #bb0000;
        margin: 10px;
    }

    .center-button {
        padding: 10px;
    }
</style>

<h3>New Event</h3>

@if (Event == null || Event.Invitees == null)
{
    <div class="spinner"></div>
}
else
{
<BSForm Model="@Event" OnValidSubmit="@HandleValidSubmit">
    <ObjectGraphDataAnnotationsValidator />
    <ValidationSummary />

    <BSContainer>
        <BSRow>
            <BSCol XS="12" LG="6">
                <label for="eventName" class="col-form-label">Event Name:</label>
                <InputText id="eventName" @bind-Value="Event.Name"></InputText>
            </BSCol>
        </BSRow>
        <BSRow>
            <BSCol XS="12" LG="6">
                <label for="structure" class="col-form-label">Select Tournament Structure: </label>
                <InputSelect id="structure" @bind-Value="@Event.TournamentStructureId" DisplayName="Tournament Structure">
                    @foreach (var structure in TournamentStructures)
                        {
                        <option value="@structure.Id">@structure.Name</option>
                        }
                </InputSelect>
            </BSCol>
        </BSRow>
        <BSRow>
            <BSCol XS="12" LG="6">
                <InputDate id="eventDate" @bind-Value="@Event.Date" format-value="MM-dd-yy"></InputDate>
                <input type="time" @bind-value="@Event.Time">
            </BSCol>
        </BSRow>

        <BSRow>
            <BSCol>
                <h3>Invitees</h3>
            </BSCol>
        </BSRow>

        @foreach (var invitee in Event.Invitees)
        {
            <BSRow Class="invitee-current">
                <BSCol XS="12" LG="3" >
                    <label for="Name">Name</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" id="Name" @bind-Value="@invitee.Name" ValidateOnChange="true" ValidateOnInput="true" />
                </BSCol>
                <BSCol XS="12" LG="3">
                    <label for="Email">Email</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" id="Email" @bind-Value="@invitee.Email" ValidateOnChange="true" ValidateOnInput="true" />
                </BSCol>
                <BSCol XS="12" LG="3">
                    <label for="Phone">Phone (optional)</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" id="Phone" @bind-Value="@invitee.Phone" ValidateOnChange="true" ValidateOnInput="true" />
                </BSCol>
                <BSCol XS="4" LG="1" Class="center-button"><BSButton Color="Color.Secondary" IsOutline="true" @onclick="@(() => EditInvitee(invitee))"><span class="oi oi-pencil"></span></BSButton></BSCol>
                <BSCol XS="4" LG="1" Class="center-button"><BSButton Color="Color.Success" IsOutline="true" @onclick="@(() => EmailInvitee(invitee))"><span class="oi oi-envelope-closed"></span></BSButton></BSCol>
                <BSCol XS="4" LG="1" Class="center-button"><BSButton Color="Color.Danger" IsOutline="true" @onclick="@(() => RemoveInvitee(invitee))"><span class="oi oi-circle-x"></span></BSButton></BSCol>
            </BSRow>
        }

        <BSRow>
            <BSCol>
                <h3>Prior Invitees</h3>
            </BSCol>
        </BSRow>

        @foreach (var invitee in PriorInvitees)
        {
            <BSRow>
                <BSCol>
                    <label for="Name">Name:</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" IsPlaintext="@invitee.IsDisabled" id="Name" @bind-Value="@invitee.Name" />
                </BSCol>
                <BSCol>
                    <label for="Email">Email:</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" IsPlaintext="@invitee.IsDisabled" id="Email" @bind-Value="@invitee.Email" />
                </BSCol>
                <BSCol>
                    <label for="Phone">Phone (optional)</label>
                    <BSBasicInput InputType="InputType.Text" IsReadonly="@invitee.IsDisabled" IsPlaintext="@invitee.IsDisabled" id="Phone" @bind-Value="@invitee.Phone" />
                </BSCol>
                <BSCol><BSButton Color="Color.Success" @onclick="@(() => AddPriorInvitee(invitee))"><span class="oi oi-plus"></span></BSButton></BSCol>
            </BSRow>
        }

        <BSRow>
            <BSCol>
                <BSButton Color="Color.Primary" @onclick="@(() => AddInvitee())"><span class="oi oi-plus"></span>Add Invitee</BSButton>
            </BSCol>
        </BSRow>

        <BSRow>
            <BSCol>
                <BSButton ButtonType="ButtonType.Submit" @onclick="@(() => IsSave = true)"><span class="oi oi-circle-check"></span> Save Event</BSButton>
            </BSCol>
            <BSCol>
                <BSButton ButtonType="ButtonType.Submit" Color="Color.Success" value="" @onclick="@(() => IsSave = false)"><span class="oi oi-media-play"></span> Begin Event</BSButton>
            </BSCol>
            <BSCol>
                <BSButton Color="Color.Success" @onclick="@EmailInvitees"><span class="oi oi-envelope-closed"></span> Email Invitees</BSButton>
            </BSCol>
            <BSCol>
                <BSButton Color="Color.Danger" @onclick="@NavigateToEvents"><span class="oi oi-circle-x"></span> Cancel</BSButton>
            </BSCol>
        </BSRow>
    </BSContainer>
</BSForm>
}

